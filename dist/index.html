<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <meta name="description" content="Runesmith">
  <meta name="keywords" content="Runesmith">

  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans+Caption:700&amp;subset=cyrillic" />
  <link rel="stylesheet" href="style.css">
  <title>Runesmith</title>

  <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">

  <script type="module" crossorigin>function W(t,e=!1){t<0&&(t=-t),0<t&&t<1&&(t=Math.floor(t*1e9));let n=i=>(t=(t*69069+1)%2**31,t%i);return i=>i==-1?t:i==null?n(1e9)/1e9:n(i)}W(Math.random());const pe=typeof performance<"u"?performance:Date;pe.now.bind(pe);function et(t){return t&&t.length>0?t[0].toUpperCase()+t.substr(1):t}function tt(t){let e=`${t}`;var n=0,r,i;if(e.length===0)return n;for(r=0;r<e.length;r++)i=e.charCodeAt(r),n=(n<<5)-n+i,n|=0;return n}function _e(t,e){return t[~~(e()*t.length)]}function nt(t){return JSON.parse(JSON.stringify(t))}function rt(t){return~~(t*100)/100}let P=t=>t&&t.toFixed(2).replace(/(.00)/g,"");const Ae=["hp","stamina","mana","armor","evade","regen"],it=["damage","critChance","critMult","speed","bleed","firstStrike"],st=["str","int","dex"];let R=[..."bcfhiorst"];const me={n:"h"," ":"x","#":"x","â¨¯":"x",q:"o"};let S=W(1);function ot(t){S=W(t)}const ge={str:{tip:"Affect item scaling"},dex:{tip:"Affect item scaling"},int:{tip:"Affect item scaling"},hp:{tip:"Fight is over when it is 0",mult:3},stamina:{tip:"Used by some weapons",mult:3},mana:{tip:"Used by some weapons",mult:3},critChance:{tip:"Hero gains +(critChance-enemyLevel) critPoints per turn. At 100 - damage multiplied by 1 + critMult/100, reset to 0"},critMult:{tip:"Hero gains +(critChance-enemyLevel) critPoints per turn. At 100 - damage multiplied by 1 + critMult/100, reset to 0"},armor:{tip:"-(armor) to enemy damage",mult:.3},manaShield:{tip:"absorb (manShield) damage total",mult:3},speed:{tip:"+(speed-elvl) speedPoints per turn. At 100 - extra turn, reset to 0"},evade:{tip:"+(evade-elvl) evadePoints per turn. At 100 - copletely evade enemy attack, reset to 0"},bleed:{tip:"enemy gains +(bleed-elvl) bleedPoints, if it was hit this turn. Enemy lose bleedPoint hp each turn.",mult:.3},regen:{tip:"hp restored each turn"},offHandDamage:{tip:"damage multiplier for offhand"},firstStrike:{tip:"damage multiplier on first turn"},damage:{tip:"base damage to enemy"}};function lt(){let t=[];for(let e=0;e<100;e++){let n="";for(let r=0;r<10;r++){let i=R[S(9)];if(i!=[...n].pop()&&(n+=i),r>3&&!S(3))break}t.push(n)}return t=t.sort((e,n)=>e.length-n.length),t}let Q=lt(),Ue=Object.fromEntries(Q.map(t=>[t,Te(t.length)]));function Te(t,e){e??=S()<.5;let n=_e(e&&S()<.7?it:Ae,S);ge[n]||console.log(n);let r=rt(t**1.5*(S()*.8+.4)*.05)*(ge[n].mult||1);return{[n]:r}}let $=Object.fromEntries(Q.map(t=>{if(S()<.25)return[t,t];{let e=[...t].map(n=>S()<.2?n:"-").join("");return[t,e]}}));function at(t){$=t}const ve={sword:{slots:["main","off"],stats:{str:1,int:1,dex:1,damage:1},shape:`
..#..
#####
.###.
.###.
.###.
..#..
`},shield:{slots:["off"],stats:{str:2,int:1,dex:1,armor:.3},shape:`
#####
##.##
##.##
.###.
`},dagger:{slots:["main","off"],stats:{str:1,int:1,dex:2,damage:.8,critChance:1.5,critMult:1.5},shape:`
....#.
...###    
...###
..###.
.###..
###...
`},hammer:{slots:["main"],stats:{int:1,dex:1,damage:1.5,str:3},shape:`
####
####
.##.
.##.
.##.
.##.
`},staff:{slots:["main"],stats:{str:1,dex:1,damage:1,manaUse:1,int:2},shape:`
.##.
####
####
.##.
.##.
.##.
`},orb:{slots:["main","off"],stats:{str:1,dex:1,int:2,damage:1,manaUse:1},shape:`
.###.
#####
#####
.###.
`},helmet:{slots:["off"],stats:{str:.5,dex:.5,int:.5,armor:.1},shape:`
.###.
#####
##.##
##.##
`},circlet:{slots:["off"],stats:{str:1,dex:1,int:2,mana:2},shape:`
 ###
##.##
#...#
##.##
.###.
`},robe:{slots:["body"],randomBonus:1,stats:{str:1,dex:1,int:2,armor:.2},shape:`
.###.
#####
.###.
#####
`},leather:{slots:["body"],stats:{str:1,dex:2,int:1,armor:1},shape:`
.###.
#####
#####
.###.
`},boots:{slots:["off"],stats:{str:1,int:1,dex:2,armor:.1,evade:1},shape:`
..###
..###
..###
#####
`},plate:{slots:["body"],stats:{armor:.5,int:1,dex:1,str:2},shape:`
#####
#####
.###.
.###.
`},anvil:{slots:["main"],stats:{int:1,dex:1,str:2,firstStrike:1},shape:`
######
.#####
..##..
.####.
`},amulet:{slots:["off"],stats:{str:1,int:2,dex:1,manaShield:1},shape:`
...#...
##.#.##
.#####.
##.#.##
`}};function X(t){let e=[];for(let n in t)t[n]&&e.push(`${n}: ${P(t[n])}`);return e.join(" | ")}var Y,y,Ne,U,ye,Re,Fe,Ie,ue,ie,se,q={},Oe=[],_t=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Z=Array.isArray;function B(t,e){for(var n in e)t[n]=e[n];return t}function ce(t){t&&t.parentNode&&t.parentNode.removeChild(t)}function ut(t,e,n){var r,i,s,l={};for(s in e)s=="key"?r=e[s]:s=="ref"?i=e[s]:l[s]=e[s];if(arguments.length>2&&(l.children=arguments.length>3?Y.call(arguments,2):n),typeof t=="function"&&t.defaultProps!=null)for(s in t.defaultProps)l[s]===void 0&&(l[s]=t.defaultProps[s]);return K(t,l,r,i,null)}function K(t,e,n,r,i){var s={type:t,props:e,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:i??++Ne,__i:-1,__u:0};return i==null&&y.vnode!=null&&y.vnode(s),s}function I(t){return t.children}function L(t,e){this.props=t,this.context=e}function F(t,e){if(e==null)return t.__?F(t.__,t.__i+1):null;for(var n;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null)return n.__e;return typeof t.type=="function"?F(t):null}function Le(t){var e,n;if((t=t.__)!=null&&t.__c!=null){for(t.__e=t.__c.base=null,e=0;e<t.__k.length;e++)if((n=t.__k[e])!=null&&n.__e!=null){t.__e=t.__c.base=n.__e;break}return Le(t)}}function be(t){(!t.__d&&(t.__d=!0)&&U.push(t)&&!V.__r++||ye!=y.debounceRendering)&&((ye=y.debounceRendering)||Re)(V)}function V(){for(var t,e,n,r,i,s,l,u=1;U.length;)U.length>u&&U.sort(Fe),t=U.shift(),u=U.length,t.__d&&(n=void 0,r=void 0,i=(r=(e=t).__v).__e,s=[],l=[],e.__P&&((n=B({},r)).__v=r.__v+1,y.vnode&&y.vnode(n),he(e.__P,n,r,e.__n,e.__P.namespaceURI,32&r.__u?[i]:null,s,i??F(r),!!(32&r.__u),l),n.__v=r.__v,n.__.__k[n.__i]=n,ze(s,n,l),r.__e=r.__=null,n.__e!=i&&Le(n)));V.__r=0}function qe(t,e,n,r,i,s,l,u,f,a,d){var o,g,h,b,w,p,m,v=r&&r.__k||Oe,x=e.length;for(f=ct(n,e,v,f,x),o=0;o<x;o++)(h=n.__k[o])!=null&&(g=h.__i==-1?q:v[h.__i]||q,h.__i=o,p=he(t,h,g,i,s,l,u,f,a,d),b=h.__e,h.ref&&g.ref!=h.ref&&(g.ref&&fe(g.ref,null,h),d.push(h.ref,h.__c||b,h)),w==null&&b!=null&&(w=b),(m=!!(4&h.__u))||g.__k===h.__k?f=We(h,f,t,m):typeof h.type=="function"&&p!==void 0?f=p:b&&(f=b.nextSibling),h.__u&=-7);return n.__e=w,f}function ct(t,e,n,r,i){var s,l,u,f,a,d=n.length,o=d,g=0;for(t.__k=new Array(i),s=0;s<i;s++)(l=e[s])!=null&&typeof l!="boolean"&&typeof l!="function"?(f=s+g,(l=t.__k[s]=typeof l=="string"||typeof l=="number"||typeof l=="bigint"||l.constructor==String?K(null,l,null,null,null):Z(l)?K(I,{children:l},null,null,null):l.constructor==null&&l.__b>0?K(l.type,l.props,l.key,l.ref?l.ref:null,l.__v):l).__=t,l.__b=t.__b+1,u=null,(a=l.__i=ht(l,n,f,o))!=-1&&(o--,(u=n[a])&&(u.__u|=2)),u==null||u.__v==null?(a==-1&&(i>d?g--:i<d&&g++),typeof l.type!="function"&&(l.__u|=4)):a!=f&&(a==f-1?g--:a==f+1?g++:(a>f?g--:g++,l.__u|=4))):t.__k[s]=null;if(o)for(s=0;s<d;s++)(u=n[s])!=null&&(2&u.__u)==0&&(u.__e==r&&(r=F(u)),Ke(u,u));return r}function We(t,e,n,r){var i,s;if(typeof t.type=="function"){for(i=t.__k,s=0;i&&s<i.length;s++)i[s]&&(i[s].__=t,e=We(i[s],e,n,r));return e}t.__e!=e&&(r&&(e&&t.type&&!e.parentNode&&(e=F(t)),n.insertBefore(t.__e,e||null)),e=t.__e);do e=e&&e.nextSibling;while(e!=null&&e.nodeType==8);return e}function ht(t,e,n,r){var i,s,l,u=t.key,f=t.type,a=e[n],d=a!=null&&(2&a.__u)==0;if(a===null&&t.key==null||d&&u==a.key&&f==a.type)return n;if(r>(d?1:0)){for(i=n-1,s=n+1;i>=0||s<e.length;)if((a=e[l=i>=0?i--:s++])!=null&&(2&a.__u)==0&&u==a.key&&f==a.type)return l}return-1}function ke(t,e,n){e[0]=="-"?t.setProperty(e,n??""):t[e]=n==null?"":typeof n!="number"||_t.test(e)?n:n+"px"}function J(t,e,n,r,i){var s,l;e:if(e=="style")if(typeof n=="string")t.style.cssText=n;else{if(typeof r=="string"&&(t.style.cssText=r=""),r)for(e in r)n&&e in n||ke(t.style,e,"");if(n)for(e in n)r&&n[e]==r[e]||ke(t.style,e,n[e])}else if(e[0]=="o"&&e[1]=="n")s=e!=(e=e.replace(Ie,"$1")),l=e.toLowerCase(),e=l in t||e=="onFocusOut"||e=="onFocusIn"?l.slice(2):e.slice(2),t.l||(t.l={}),t.l[e+s]=n,n?r?n.u=r.u:(n.u=ue,t.addEventListener(e,s?se:ie,s)):t.removeEventListener(e,s?se:ie,s);else{if(i=="http://www.w3.org/2000/svg")e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t)try{t[e]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&e[4]!="-"?t.removeAttribute(e):t.setAttribute(e,e=="popover"&&n==1?"":n))}}function Se(t){return function(e){if(this.l){var n=this.l[e.type+t];if(e.t==null)e.t=ue++;else if(e.t<n.u)return;return n(y.event?y.event(e):e)}}}function he(t,e,n,r,i,s,l,u,f,a){var d,o,g,h,b,w,p,m,v,x,H,D,A,j,z,O,ee,M=e.type;if(e.constructor!=null)return null;128&n.__u&&(f=!!(32&n.__u),s=[u=e.__e=n.__e]),(d=y.__b)&&d(e);e:if(typeof M=="function")try{if(m=e.props,v="prototype"in M&&M.prototype.render,x=(d=M.contextType)&&r[d.__c],H=d?x?x.props.value:d.__:r,n.__c?p=(o=e.__c=n.__c).__=o.__E:(v?e.__c=o=new M(m,H):(e.__c=o=new L(m,H),o.constructor=M,o.render=dt),x&&x.sub(o),o.props=m,o.state||(o.state={}),o.context=H,o.__n=r,g=o.__d=!0,o.__h=[],o._sb=[]),v&&o.__s==null&&(o.__s=o.state),v&&M.getDerivedStateFromProps!=null&&(o.__s==o.state&&(o.__s=B({},o.__s)),B(o.__s,M.getDerivedStateFromProps(m,o.__s))),h=o.props,b=o.state,o.__v=e,g)v&&M.getDerivedStateFromProps==null&&o.componentWillMount!=null&&o.componentWillMount(),v&&o.componentDidMount!=null&&o.__h.push(o.componentDidMount);else{if(v&&M.getDerivedStateFromProps==null&&m!==h&&o.componentWillReceiveProps!=null&&o.componentWillReceiveProps(m,H),!o.__e&&o.shouldComponentUpdate!=null&&o.shouldComponentUpdate(m,o.__s,H)===!1||e.__v==n.__v){for(e.__v!=n.__v&&(o.props=m,o.state=o.__s,o.__d=!1),e.__e=n.__e,e.__k=n.__k,e.__k.some(function(N){N&&(N.__=e)}),D=0;D<o._sb.length;D++)o.__h.push(o._sb[D]);o._sb=[],o.__h.length&&l.push(o);break e}o.componentWillUpdate!=null&&o.componentWillUpdate(m,o.__s,H),v&&o.componentDidUpdate!=null&&o.__h.push(function(){o.componentDidUpdate(h,b,w)})}if(o.context=H,o.props=m,o.__P=t,o.__e=!1,A=y.__r,j=0,v){for(o.state=o.__s,o.__d=!1,A&&A(e),d=o.render(o.props,o.state,o.context),z=0;z<o._sb.length;z++)o.__h.push(o._sb[z]);o._sb=[]}else do o.__d=!1,A&&A(e),d=o.render(o.props,o.state,o.context),o.state=o.__s;while(o.__d&&++j<25);o.state=o.__s,o.getChildContext!=null&&(r=B(B({},r),o.getChildContext())),v&&!g&&o.getSnapshotBeforeUpdate!=null&&(w=o.getSnapshotBeforeUpdate(h,b)),O=d,d!=null&&d.type===I&&d.key==null&&(O=Je(d.props.children)),u=qe(t,Z(O)?O:[O],e,n,r,i,s,l,u,f,a),o.base=e.__e,e.__u&=-161,o.__h.length&&l.push(o),p&&(o.__E=o.__=null)}catch(N){if(e.__v=null,f||s!=null)if(N.then){for(e.__u|=f?160:128;u&&u.nodeType==8&&u.nextSibling;)u=u.nextSibling;s[s.indexOf(u)]=null,e.__e=u}else{for(ee=s.length;ee--;)ce(s[ee]);oe(e)}else e.__e=n.__e,e.__k=n.__k,N.then||oe(e);y.__e(N,e,n)}else s==null&&e.__v==n.__v?(e.__k=n.__k,e.__e=n.__e):u=e.__e=ft(n.__e,e,n,r,i,s,l,f,a);return(d=y.diffed)&&d(e),128&e.__u?void 0:u}function oe(t){t&&t.__c&&(t.__c.__e=!0),t&&t.__k&&t.__k.forEach(oe)}function ze(t,e,n){for(var r=0;r<n.length;r++)fe(n[r],n[++r],n[++r]);y.__c&&y.__c(e,t),t.some(function(i){try{t=i.__h,i.__h=[],t.some(function(s){s.call(i)})}catch(s){y.__e(s,i.__v)}})}function Je(t){return typeof t!="object"||t==null||t.__b&&t.__b>0?t:Z(t)?t.map(Je):B({},t)}function ft(t,e,n,r,i,s,l,u,f){var a,d,o,g,h,b,w,p=n.props,m=e.props,v=e.type;if(v=="svg"?i="http://www.w3.org/2000/svg":v=="math"?i="http://www.w3.org/1998/Math/MathML":i||(i="http://www.w3.org/1999/xhtml"),s!=null){for(a=0;a<s.length;a++)if((h=s[a])&&"setAttribute"in h==!!v&&(v?h.localName==v:h.nodeType==3)){t=h,s[a]=null;break}}if(t==null){if(v==null)return document.createTextNode(m);t=document.createElementNS(i,v,m.is&&m),u&&(y.__m&&y.__m(e,s),u=!1),s=null}if(v==null)p===m||u&&t.data==m||(t.data=m);else{if(s=s&&Y.call(t.childNodes),p=n.props||q,!u&&s!=null)for(p={},a=0;a<t.attributes.length;a++)p[(h=t.attributes[a]).name]=h.value;for(a in p)if(h=p[a],a!="children"){if(a=="dangerouslySetInnerHTML")o=h;else if(!(a in m)){if(a=="value"&&"defaultValue"in m||a=="checked"&&"defaultChecked"in m)continue;J(t,a,null,h,i)}}for(a in m)h=m[a],a=="children"?g=h:a=="dangerouslySetInnerHTML"?d=h:a=="value"?b=h:a=="checked"?w=h:u&&typeof h!="function"||p[a]===h||J(t,a,h,p[a],i);if(d)u||o&&(d.__html==o.__html||d.__html==t.innerHTML)||(t.innerHTML=d.__html),e.__k=[];else if(o&&(t.innerHTML=""),qe(e.type=="template"?t.content:t,Z(g)?g:[g],e,n,r,v=="foreignObject"?"http://www.w3.org/1999/xhtml":i,s,l,s?s[0]:n.__k&&F(n,0),u,f),s!=null)for(a=s.length;a--;)ce(s[a]);u||(a="value",v=="progress"&&b==null?t.removeAttribute("value"):b!=null&&(b!==t[a]||v=="progress"&&!b||v=="option"&&b!=p[a])&&J(t,a,b,p[a],i),a="checked",w!=null&&w!=t[a]&&J(t,a,w,p[a],i))}return t}function fe(t,e,n){try{if(typeof t=="function"){var r=typeof t.__u=="function";r&&t.__u(),r&&e==null||(t.__u=t(e))}else t.current=e}catch(i){y.__e(i,n)}}function Ke(t,e,n){var r,i;if(y.unmount&&y.unmount(t),(r=t.ref)&&(r.current&&r.current!=t.__e||fe(r,null,e)),(r=t.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(s){y.__e(s,e)}r.base=r.__P=null}if(r=t.__k)for(i=0;i<r.length;i++)r[i]&&Ke(r[i],e,n||typeof t.type!="function");n||ce(t.__e),t.__c=t.__=t.__e=void 0}function dt(t,e,n){return this.constructor(t,n)}function pt(t,e,n){var r,i,s,l;e==document&&(e=document.documentElement),y.__&&y.__(t,e),i=(r=!1)?null:e.__k,s=[],l=[],he(e,t=e.__k=ut(I,null,[t]),i||q,q,e.namespaceURI,i?null:e.firstChild?Y.call(e.childNodes):null,s,i?i.__e:e.firstChild,r,l),ze(s,t,l)}Y=Oe.slice,y={__e:function(t,e,n,r){for(var i,s,l;e=e.__;)if((i=e.__c)&&!i.__)try{if((s=i.constructor)&&s.getDerivedStateFromError!=null&&(i.setState(s.getDerivedStateFromError(t)),l=i.__d),i.componentDidCatch!=null&&(i.componentDidCatch(t,r||{}),l=i.__d),l)return i.__E=i}catch(u){t=u}throw t}},Ne=0,L.prototype.setState=function(t,e){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=B({},this.state),typeof t=="function"&&(t=t(B({},n),this.props)),t&&B(n,t),t!=null&&this.__v&&(e&&this._sb.push(e),be(this))},L.prototype.forceUpdate=function(t){this.__v&&(this.__e=!0,t&&this.__h.push(t),be(this))},L.prototype.render=I,U=[],Re=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Fe=function(t,e){return t.__v.__b-e.__v.__b},V.__r=0,Ie=/(PointerCapture)$|Capture$/i,ue=0,ie=Se(!1),se=Se(!0);var mt=0;function c(t,e,n,r,i,s){e||(e={});var l,u,f=e;if("ref"in f)for(u in f={},e)u=="ref"?l=e[u]:f[u]=e[u];var a={type:t,props:f,key:n,ref:l,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--mt,__i:-1,__u:0,__source:i,__self:s};if(typeof t=="function"&&(l=t.defaultProps))for(u in l)f[u]===void 0&&(f[u]=l[u]);return y.vnode&&y.vnode(a),a}var le,C,te,we,Ce=0,Ge=[],k=y,xe=k.__b,$e=k.__r,Ee=k.diffed,He=k.__c,Me=k.unmount,Be=k.__;function gt(t,e){k.__h&&k.__h(C,t,Ce||e),Ce=0;var n=C.__H||(C.__H={__:[],__h:[]});return t>=n.__.length&&n.__.push({}),n.__[t]}function vt(t,e){var n=gt(le++,3);!k.__s&&kt(n.__H,e)&&(n.__=t,n.u=e,C.__H.__h.push(n))}function yt(){for(var t;t=Ge.shift();)if(t.__P&&t.__H)try{t.__H.__h.forEach(G),t.__H.__h.forEach(ae),t.__H.__h=[]}catch(e){t.__H.__h=[],k.__e(e,t.__v)}}k.__b=function(t){C=null,xe&&xe(t)},k.__=function(t,e){t&&e.__k&&e.__k.__m&&(t.__m=e.__k.__m),Be&&Be(t,e)},k.__r=function(t){$e&&$e(t),le=0;var e=(C=t.__c).__H;e&&(te===C?(e.__h=[],C.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(e.__h.forEach(G),e.__h.forEach(ae),e.__h=[],le=0)),te=C},k.diffed=function(t){Ee&&Ee(t);var e=t.__c;e&&e.__H&&(e.__H.__h.length&&(Ge.push(e)!==1&&we===k.requestAnimationFrame||((we=k.requestAnimationFrame)||bt)(yt)),e.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),te=C=null},k.__c=function(t,e){e.some(function(n){try{n.__h.forEach(G),n.__h=n.__h.filter(function(r){return!r.__||ae(r)})}catch(r){e.some(function(i){i.__h&&(i.__h=[])}),e=[],k.__e(r,n.__v)}}),He&&He(t,e)},k.unmount=function(t){Me&&Me(t);var e,n=t.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{G(r)}catch(i){e=i}}),n.__H=void 0,e&&k.__e(e,n.__v))};var je=typeof requestAnimationFrame=="function";function bt(t){var e,n=function(){clearTimeout(r),je&&cancelAnimationFrame(e),setTimeout(t)},r=setTimeout(n,35);je&&(e=requestAnimationFrame(n))}function G(t){var e=C,n=t.__c;typeof n=="function"&&(t.__c=void 0,n()),C=e}function ae(t){var e=C;t.__c=t.__(),C=e}function kt(t,e){return!t||t.length!==e.length||e.some(function(n,r){return n!==t[r]})}const Ve=["main","off","body"];let _={shape:null,heroes:[],runeButton:null,edited:[-1,0],hovered:[-1,0],storage:[],money:100,chosen:null,day:1};function Qe(t){let e={money:_.money,day:_.day};e.heroes=_.heroes.map(n=>({lvl:n.lvl})),e.storage=_.storage.map(n=>n.save()),e.known=$,e.shape=_.storage.indexOf(_.shape),e.chosen=_.chosen,localStorage["runesmith"+t]=JSON.stringify(e)}function Pe(t){let e=localStorage["runesmith"+t];if(!e){alert("No save in slot "+t);return}let n=JSON.parse(e);for(let r in n.heroes)_.heroes[r].lvl=n.heroes[r].lvl;_.money=n.money,_.day=n.day,at(n.known),_.storage=n.storage.map(r=>Ye.load(r)),_.shape=_.storage[n.shape],_.chosen=n.chosen,E()}let de;class St extends L{constructor(){super(),de=this}render(){return c("table",{class:"main",children:[c("thead",{children:c("tr",{children:c("td",{colSpan:2,children:[[1,2,3].map(e=>c(I,{children:[c("button",{onClick:()=>Qe(e),children:["Save ",e]}),c("button",{onClick:()=>Pe(e),children:["Load ",e]})]})),c("button",{onClick:()=>Pe("a"),children:"Load Autosave"})]})})}),c("tbody",{children:[c("tr",{children:[c("td",{children:["Day: ",_.day,c("br",{}),"Funds: $",_.money]}),c("td",{rowSpan:2,children:_.chosen?c(Ct,{}):_.shape?c(xt,{}):""})]}),c("tr",{children:c("td",{children:ne(_.heroes[0])})}),c("tr",{children:[c("td",{children:ne(_.heroes[1])}),c("td",{rowSpan:2,children:c("div",{class:"storage",children:_.storage.map(e=>c("button",{class:e==_.shape?"current":"",onClick:()=>E({shape:e}),children:[e?.title(),e.usedBy?` (on ${e.usedBy})`:""]}))})})]}),c("tr",{children:c("td",{children:ne(_.heroes[2])})})]})]})}}function ne(t){return c("div",{class:"hero-card",children:[c("button",{onClick:()=>E({chosen:t.role}),children:c("b",{children:t.title()})}),Ve.map(e=>{let n=t[e];return c("div",{children:[c("button",{onClick:()=>n&&E({shape:n}),children:n?.title()||"Nothing"}),_.shape?.slots.includes(e)&&_.shape!=n&&c("button",{onClick:()=>{_.shape&&(t.equip(e,_.shape)||alert("wrong slot"),E())},children:" < "})]})}),c("div",{class:"can-beat",children:[" Can beat lvl ",t.bestEnemy," "]})]})}function wt(){let t=document.getElementById("routes"),e=document.getElementById("gtable"),n=document.querySelector(".project-rune");if(!_.shape||!t||!e||!n)return;let r=n.getBoundingClientRect().width,i,s=l=>[(l[0]+.4+i()*.3)*r,(l[1]+.4+i()*.3)*r];if(t&&e){e.getBoundingClientRect();let l=r*_.shape.w,u=r*_.shape.h;t.width=l,t.style.width=`${l}px`,t.height=u,t.style.height=`${u}px`;let f=t.getContext("2d");for(let a in _.shape.solutions){i=W(tt(a)),f.lineWidth=r*.05*(_.shape.activated[a]?2:.7),f.strokeStyle=`hsl(${i(360)} 80% 60% / 0.7)`;let d=_.shape.solutions[a],o=s(d[0]);f.beginPath(),f.moveTo(...o);for(let g=1;d[g];g++){let h=s(d[g]);f.lineTo(...h)}f.stroke()}}}async function E(t){t?.shape&&(t.chosen=void 0),t&&(_={..._,...t}),_.shape?.update(),de.setState(_),wt()}function De(t){return t=t?.toLowerCase(),me[t]&&(t=me[t]),t>="1"&&t<="9"?R[Number(t)-1]:R.includes(t)||t=="x"||t=="="?t:null}function Ct(){let t=_.heroes.find(r=>r.role==_.chosen);if(!t)return"";let e=t.emulateCombat(t.bestEnemy)[1],n=t.emulateCombat(t.bestEnemy+1)[1];return c("div",{class:"hero-ui",children:[c("div",{children:["= ",t.title()," =",c("hr",{}),t.statsString(),Ve.map(r=>t[r]?c("p",{children:[c("button",{onClick:()=>E({shape:t[r]}),children:"Edit"}),c("div",{children:["=",t[r].title(),"="]}),t[r].heroMultiplier!=1?c("div",{children:["All bonuses x ",t[r].heroMultiplier," because of insufficient ",t[r].limitingStat]}):"",X(t[r].s)," "]}):"")]}),c("div",{class:"combat-log",children:[c("h4",{children:["Wins against lvl ",t.bestEnemy," enemy"]}),e.map(r=>c("div",{children:r}))]}),c("div",{class:"combat-log",children:[c("h4",{children:["Loses to lvl ",t.bestEnemy+1," enemy"]}),n.map(r=>c("div",{children:r}))]})]})}function xt(){function t(r){_.runeButton=r,E()}vt(()=>{let r=i=>{if(i.code=="Space"||i.code=="Equal"||i.code=="Enter"||i.code.includes("Key")||i.code.includes("Digit")||i.code.includes("Numpad")){let s=[...i.code].pop();i.code=="Space"&&(s=" "),(i.code=="Equal"||i.code=="Enter")&&(s="="),e(_.hovered,De(s))}};return document.addEventListener("keydown",r),()=>{document.removeEventListener("keydown",r)}},[]);function e(r,i){!i||!r||r[0]<0||_.shape.current[r[1]][r[0]]!="#"||(i=De(i),(i=="x"||i==_.shape.project[r[1]][r[0]])&&(i=_.shape.current[r[1]][r[0]]),i!="x"&&(i!="="?_.shape.project[r[1]][r[0]]=i:_.shape.carve(r),E()))}function n(r,i){let s=_.shape.current[r[1]][r[0]];return c("div",{class:"project-rune"+(s!=i?" changing":""),children:i=="#"?"â€¢":i})}return c(I,{children:[c("div",{class:"item-stats",children:[_.shape?.statsString()," ",c("button",{onClick:()=>_.shape.sell(),children:["Sell for $",_.shape.price()]})]}),c("div",{class:"bench",children:[c("div",{class:"gtablediv",children:c("table",{id:"gtable",children:c("tbody",{children:_.shape.project.map((r,i)=>c("tr",{children:r.map((s,l)=>c("td",{children:c("div",{class:"rune "+(l==_.edited[0]&&i==_.edited[1]?"current":""),style:{visibility:s!="."?"visible":"hidden"},onMouseDown:u=>{u.shiftKey?e([l,i],"="):e([l,i],_.runeButton)},onMouseMove:u=>{_.hovered=[l,i],focus(),E()},onMouseLeave:u=>{_.hovered=[..._.edited],E()},children:n([l,i],s)})}))}))})})}),c("div",{class:"runeButtons",children:[...R,"â¨¯","="].map((r,i)=>c("button",{class:_.runeButton==r?"active":"",onClick:s=>{t(r)},children:[" ",r=="="?"ð“‹":r,c("div",{class:"tip",children:R.includes(r)?`${r}/${i+1}`:r})]}))}),c("canvas",{id:"routes"}),c("div",{children:c("div",{class:"words",children:Q.sort((r,i)=>(r==$[r]?r.length:100)-(i==$[i]?i.length:100)).map(r=>c("div",{class:"word hastip "+(_.shape?.solutions[r]?"active":""),children:[$[r],c("div",{class:"tip",children:X(Ue[r])})]}))})})]})]})}function $t(t,e){_.shape=t,_.heroes=e,t.update(),pt(c(St,{}),document.body)}const Et=[[1,0],[-1,0],[0,1],[0,-1]];function Ht(t,e){return[t[0]+e[0],t[1]+e[1]]}function Mt(t,e){return t[0]==e[0]&&t[1]==e[1]}function Xe(t,e,n=1){for(let r in e)t[r]=(t[r]||0)+e[r]*n}function T(t,e,n){t=~~t,n??=_e(Object.keys(ve),e);let r=ve[n],i=new Ye(n,{...r,skipChance:.1,letterChance:.2});for(let l in r.stats)i.s[l]=~~(r.stats[l]*t);let s=Te(e(2)+3,i.s.damage>0);return Xe(i.s,s,t),i.level=t,i.update(),_.storage.push(i),i}class Ye{constructor(e,n){this.name=e;let i=n.shape.trim().split(`
`);if(this.w=i[0].length,this.h=i.length,this.current=i.map(s=>[...s]),this.slots=n.slots,n.skipChance||n.letterChance){let s=W(S());this.eachCell(l=>{this.current[l[1]][l[0]]!="."&&(s()<n.skipChance?this.current[l[1]][l[0]]=".":s()<n.letterChance&&(this.current[l[1]][l[0]]=_e(R,s)))})}this.project=nt(this.current),this.solve(),this.warp=0}w;h;current;project;solutions={};activated={};s={};m={};level;warp=0;slots;usedBy;slot;foundBy;heroMultiplier;limitingStat;title(){return`${et(this.name)}${this.pluses()?"+"+this.pluses():""} lvl ${P(this.level)}`}pluses(){return Object.keys(this.activated).length}save(){return{level:this.level,warp:this.warp,name:this.name,slot:this.slot,usedBy:this.usedBy,foundBy:this.foundBy,s:this.s,current:this.current.map(e=>e.join("")).join(`
`),project:this.project.map(e=>e.join("")).join(`
`)}}static load(e){let n=T(e.level,S,e.name);return Object.assign(n,e),n.current=e.current.split(`
`).map(r=>[...r]),n.project=e.project.split(`
`).map(r=>[...r]),n.usedBy&&Ze(n.usedBy).equip(e.slot,n),n.update(),n}leveledCopy(){}toString(){return this.current.join(`
`)}eachCell(e){for(let n=0;n<this.w;n++)for(let r=0;r<this.h;r++)if(e([n,r]))return}p(e){return(this.project[e[1]]||[])[e[0]]}setp(e,n){(this.project[e[1]]||[])[e[0]]=n}c(e){return(this.current[e[1]]||[])[e[0]]}setc(e,n){(this.current[e[1]]||[])[e[0]]=n}update(){this.solve(!0),this.solve(!1)}solve(e=!1){let n={};for(let r of Q)this.eachCell(i=>{let s=this.solveStarting(i,r,e||$[r]!=r,[]);if(s)return n[r]=s,!0});for(let r in n)$[r]!=r&&($[r]=r,console.log("Found new word: "+r),de?.forceUpdate());if(e){for(let r in n)if(!this.activated[r]){let i=Ue[r];Xe(this.s,i,this.level),this.warp++;for(let s of r)for(let l in $)$[l]!=l&&[...l].forEach((u,f)=>{if(u==s&&S()<.005){let a=[...$[l]];a[f]=s,$[l]=a.join("")}})}this.activated=n}else this.solutions=n;return n}statsString(){return`=${this.title()}= Carving cost: $${this.carveCost()} | ${this.foundBy?`Found by ${this.foundBy} | `:""} ${X(this.s)}`}carveCost(){return 2**this.warp}carve(e){if(_.money<this.carveCost()){alert("Too expensive!");return}E({money:_.money-this.carveCost(),day:_.day+1});for(let r of _.heroes)r.doDay();let n=this.project[e[1]][e[0]];this.current[e[1]][e[0]]=n,this.warp++,Qe("a")}solveStarting(e,n,r,i){let s=r?this.c(e):this.p(e);if(n[0]!=s)return!1;if(n=n.substring(1,100),n.length==0)return[e];for(let l of Et){let u=Ht(e,l);if(i.some(a=>Mt(a,u)))continue;let f=this.solveStarting(u,n,r,[...i,e]);if(f)return[e,...f]}return!1}sell(){_.storage=_.storage.filter(e=>e!=this),E({money:_.money+this.price(),shape:_.shape==this?null:_.shape})}price(){return~~(this.level+1)}}function Bt(){return{str:0,dex:0,int:0,hp:0,stamina:0,mana:0,armor:0,manaShield:0,evade:0,regen:0,damage:0,critChance:0,critMult:0,speed:0,bleed:0,staminaUse:0,manaUse:0,offHandDamage:0,firstStrike:0}}function Ze(t){return _.heroes.find(e=>e.role==t)}const jt={Knight:{hp:1.2,str:1.5,int:1,dex:1,stamina:1.5,mana:1,offHandDamage:.7},Wizard:{hp:1,str:1,int:1.5,dex:1,stamina:1,mana:1.5,offHandDamage:.7},Rogue:{hp:1,str:1,int:1,dex:1.5,stamina:1,mana:1,offHandDamage:1}};class re{main;off;body;s;role;lvl;bestEnemy=0;constructor(e,n){this.role=e,this.lvl=n,this.updateStats(this.lvl)}doDay(){if(S()<.3){let n=T(this.bestEnemy,S);n.foundBy=this.role}let e=Math.min(.1,this.bestEnemy**2/(this.lvl+1)**2.5*.1);this.lvl+=e}title(){return`${this.role} lvl ${P(this.lvl)}`}statsString(){return`${X(this.s)}`}equip(e,n){if(!n.slots.includes(e))return!1;if(n.usedBy){let r=Ze(n.usedBy);r[n.slot]=null,r.updateStats()}return this[e]&&(this[e].usedBy=null),this[e]=n,n.usedBy=this.role,n.slot=e,this.calculateHeroMultiplier(n),this.updateStats(),!0}getRandomItems(...e){return this.equip("main",T(this.lvl,S,e[0])),this.equip("off",T(this.lvl,S,e[1])),this.equip("body",T(this.lvl,S,e[2])),this.updateStats(),this}updateStats(e){e?this.lvl=e:e=this.lvl;let n=Bt(),r=jt[this.role];n.hp=e*5*r.hp,n.stamina=e*5*r.stamina,n.mana=e*5*r.mana,n.str=e*r.str,n.int=e*r.int,n.dex=e*r.dex,n.offHandDamage=r.offHandDamage;for(let i of[this.main,this.off,this.body])if(i)for(let s of Ae)i.s[s]&&(n[s]=(n[s]||0)+(i.m[s]||0));this.s=n,this.findBestEnemy()}calculateHeroMultiplier(e){let n=1,r="";for(let i of st){let s=Math.min(1,this.s[i]/e.s[i]);s<n&&(n=s,r=i)}return e.heroMultiplier=n,e.limitingStat=r,e.m=Object.fromEntries(Object.entries(e.s).map(([i,s])=>[i,s*e.heroMultiplier])),n}findBestEnemy(){let e;for(e=1;e<1e3;e++){let n=this.emulateCombat(e);if(n[0]==!1)return this.bestEnemy=e-1,[e-1,n[1]]}}emulateCombat(e){let n=[],r=this.s,i,s=r.hp,l=r.mana,u=r.stamina,f=r.manaShield,a=e*3,d=e,o=0,g=0;function h(p){n.push(p)}function b(p,m=1){if(!p)return()=>{};if(!(p.m.damage>0))return()=>{};let v=0,x=0,H=p.m.damage*m-e/2,D=(A=!1)=>{if(A||(x+=r.speed-e),v+=r.critChance+10-e,u<p.s.staminaUse){u>0&&h("Out of Stamina");return}if(l<=p.s.manaUse){l>0&&h("Out of Mana");return}u-=p.m.staminaUse,l-=p.m.manaUse;let j=H;if(v>=100&&(v=0,j*=1.5+r.critMult/100,h("CRIT!")),i==1&&(j*=1+r.firstStrike/100),h(j?`Dealing ${P(j)} damage`:"Enemy armor blocks all damage"),o&&h(`Enemy bleeds for ${P(o)} dmg`),a-=j+o,isNaN(a))debugger;p.m.bleed&&(o+=p.m.bleed),x>100&&(x=0,D(!0))};return D}let w=[b(this.main,1),b(this.off,this.s.offHandDamage)];for(i=1;i<=10;i++){if(s<=0||a<=0)return;if(h(`= Turn ${i} =`),w[0](),w[1](),a<=0)return h("Victory"),[!0,n];if(g+=r.evade-e,g>=100)g=0,h("Evading all damage");else{let p=d;if(f>0){let m=Math.min(f,p);m>0&&(h(`Mana shield blocks ${m} dmg`),f-=m,p-=m)}if(p-=r.armor,p>0&&(s-=p,h(`Taking ${p} dmg`),s<=0))return h(`${P(s)} left. Need better defence.`),[!1,n]}h(`Me: ${P(s)} hp Enemy: ${P(a)} hp`)}return h("turn limit reached, enemy escapes. Have to deal damage faster."),[!1,n]}}ot(1);let Pt=[new re("Knight",10).getRandomItems("sword","shield","plate"),new re("Wizard",10).getRandomItems("orb","amulet","robe"),new re("Rogue",10).getRandomItems("dagger","boots","leather")];[...new Array(20)].map(t=>T(5+S(10),S));$t(T(10,S),Pt);</script>
</head>

<body>
  
  

</body>


</html>